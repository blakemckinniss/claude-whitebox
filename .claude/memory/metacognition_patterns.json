{
  "semantic_signals": {
    "research_needed": {
      "patterns": [
        "(?:latest|current|updated|new|2024|2025) (?:version|api|docs|features)",
        "(?:how does|how to).+(?:work|use) (?:in|with) \\w+",
        "(?:playwright|fastapi|react|nextjs|tailwind|anthropic|openai|langchain)",
        "(?:compatible|support|available) (?:in|with)",
        "(?:documentation|docs) for"
      ],
      "nudge_template": "üî¨ RESEARCH SIGNAL: This involves recent libraries/APIs (training cutoff: Jan 2025).\n   ‚Ä¢ Your knowledge may be stale\n   ‚Ä¢ Use: /research '{query}' (live web search)\n   ‚Ä¢ Example: /research 'Playwright auto-waiting 2025'\n   ‚Ä¢ Prevents hallucinating outdated APIs",
      "confidence_threshold": 50,
      "priority": "high"
    },
    "browser_automation": {
      "patterns": [
        "(?:scrape|scraping|crawl|crawling|extract|extracting)",
        "(?:login|fill|submit|click).+(?:form|button|element|page|site)",
        "(?:javascript|dynamic|spa|react).+(?:content|site|page)",
        "(?:screenshot|pdf|headless|browser|selenium|puppeteer)",
        "(?:automation|automate).+(?:browser|web|site)"
      ],
      "nudge_template": "üé≠ PLAYWRIGHT SIGNAL: This requires browser automation.\n   ‚Ä¢ Static scraping (requests/BeautifulSoup) WILL FAIL on JS sites\n   ‚Ä¢ Use: python3 scripts/ops/playwright.py '{task}'\n   ‚Ä¢ Scaffolds complete solution in scratch/ (zero friction)\n   ‚Ä¢ Handles: login, waits, screenshots, PDFs automatically",
      "confidence_threshold": 0,
      "priority": "critical"
    },
    "xy_problem": {
      "patterns": [
        "(?:can|how).+(?:make|do|create).+(?:so that|because|in order to)",
        "(?:trying to|want to|need to).+but.+(?:not working|failing|error)",
        "(?:workaround|hack) (?:for|to)",
        "(?:is there a way to).+(?:without|avoid)"
      ],
      "nudge_template": "üéØ XY PROBLEM ALERT: You stated HOW, but not WHY.\n   ‚Ä¢ What is the ACTUAL end goal?\n   ‚Ä¢ Is there a simpler path to achieve it?\n   ‚Ä¢ Meta-question: Should I ask user for clarification?\n   ‚Ä¢ Often the stated problem is not the real problem",
      "confidence_threshold": 0,
      "priority": "high"
    },
    "decision_complexity": {
      "patterns": [
        "(?:should|shall) (?:we|i) (?:use|choose|migrate|switch|add|adopt)",
        "(?:better|best|recommend|suggest).+(?:approach|library|tool|framework|way)",
        "(?:vs|versus|or|between).+(?:and|,)",
        "(?:worth|trade.?off|pros.?cons)",
        "(?:migrate|migration|switch|switching|move|moving).+(?:to|from)"
      ],
      "nudge_template": "‚öñÔ∏è DECISION COMPLEXITY: Strategic choice detected.\n   ‚Ä¢ Single advisor = confirmation bias\n   ‚Ä¢ Use: python3 scripts/ops/balanced_council.py '{proposal}'\n   ‚Ä¢ 6 perspectives (Six Thinking Hats) ‚Üí clear verdict\n   ‚Ä¢ Time: ~60s for comprehensive analysis\n   ‚Ä¢ Prevents groupthink and blind spots",
      "confidence_threshold": 40,
      "priority": "high"
    },
    "api_uncertainty": {
      "patterns": [
        "(?:methods|functions|attributes|api|properties).+(?:available|exist|support|have)",
        "(?:how to call|how to use).+(?:method|function|class|api)",
        "(?:pandas|boto3|fastapi|sqlalchemy|requests|anthropic|openai)\\.",
        "(?:does|can).+(?:have|support) (?:a|an) (?:method|function|attribute)",
        "what (?:methods|functions|properties)"
      ],
      "nudge_template": "üî¨ API UNCERTAINTY: Don't guess method signatures.\n   ‚Ä¢ Use: /probe {library}.{object}\n   ‚Ä¢ Shows actual runtime API (not guesses)\n   ‚Ä¢ Example: /probe pandas.DataFrame\n   ‚Ä¢ Prevents hallucinated methods (anti-gaslighting)",
      "confidence_threshold": 0,
      "priority": "critical"
    },
    "iteration_detected": {
      "patterns": [
        "(?:for each|for all|process all|iterate|loop|batch)",
        "(?:multiple|several|many|all).+(?:files|items|records|entries)",
        "\\d+ (?:files|items|times|steps|operations)",
        "(?:one by one|sequentially|in sequence)"
      ],
      "nudge_template": "üîÅ ITERATION DETECTED: Manual loops are banned.\n   ‚Ä¢ Write script to scratch/ using parallel.py\n   ‚Ä¢ Prevents: token waste, slow execution, manual errors\n   ‚Ä¢ Pattern: Write once, execute in parallel (max_workers=50)\n   ‚Ä¢ Scratch-First Enforcement will block manual iteration",
      "confidence_threshold": 0,
      "priority": "high"
    },
    "verification_gap": {
      "patterns": [
        "(?:fixed|done|completed|working|solved|resolved)",
        "(?:should|will|now) (?:work|pass|succeed)",
        "(?:i've|i have) (?:updated|changed|modified|fixed)",
        "(?:no longer|not) (?:failing|broken|erroring)"
      ],
      "nudge_template": "‚ö†Ô∏è VERIFICATION GAP: Claims require proof.\n   ‚Ä¢ Before 'Fixed': /verify command_success '{test}'\n   ‚Ä¢ Reality Check Protocol: Exit code 0 = truth\n   ‚Ä¢ Examples:\n     - /verify file_exists 'config.json'\n     - /verify grep_text 'app.py' --expected 'DEBUG = False'\n     - /verify command_success 'pytest tests/'\n   ‚Ä¢ Anti-gaslighting enforcement: LLMs hallucinate success",
      "confidence_threshold": 0,
      "priority": "critical"
    },
    "production_gate": {
      "patterns": [
        "scripts/ops/\\w+\\.py",
        "(?:production|deploy|release|commit|push)",
        "(?:ready|finished).+(?:feature|implementation|code)",
        "(?:promote|move).+(?:to|into) (?:scripts|production)"
      ],
      "nudge_template": "üõ°Ô∏è QUALITY GATE: Production code requires validation.\n   ‚Ä¢ /audit {file} (security: secrets, injection, hardcoded creds)\n   ‚Ä¢ /void {file} (completeness: stubs, TODOs, missing CRUD)\n   ‚Ä¢ Both must pass before scripts/ops/ writes\n   ‚Ä¢ Gatekeeper hook will block deadly sins",
      "confidence_threshold": 70,
      "priority": "critical"
    },
    "complexity_smell": {
      "patterns": [
        "(?:complicated|complex|difficult|hard|tricky|confusing)",
        "(?:workaround|hack|manual|custom).+(?:solution|fix|implementation)",
        "(?:lot of|many|lots of).+(?:steps|changes|files|modifications)",
        "(?:nested|deep|multiple).+(?:loops|conditions|levels)"
      ],
      "nudge_template": "üí° COMPLEXITY SMELL: If it feels hard, there might be a simpler way.\n   ‚Ä¢ Inversion: What if we DON'T do this at all?\n   ‚Ä¢ Deletion: Can we delete code instead of adding?\n   ‚Ä¢ Tool fit: Is there an existing tool/library for this?\n   ‚Ä¢ Meta-question: Are we over-engineering?\n   ‚Ä¢ Occam's Razor: Simplest solution is usually best",
      "confidence_threshold": 30,
      "priority": "medium"
    },
    "test_strategy": {
      "patterns": [
        "(?:test|testing|verify|validate|check).+(?:works|correct|valid)",
        "(?:unit|integration|e2e|end.to.end|spec)",
        "(?:coverage|assertions|mock|fixture)",
        "(?:write|add|create).+(?:test|spec)"
      ],
      "nudge_template": "üß™ TEST STRATEGY: Pareto testing - critical paths only.\n   ‚Ä¢ Don't test: getters, setters, trivial code\n   ‚Ä¢ Do test: edge cases, integration, business logic\n   ‚Ä¢ Anti-pattern: Mock-heavy tests (brittle, low value)\n   ‚Ä¢ Use: pytest for simplicity, avoid over-mocking\n   ‚Ä¢ Philosophy: 20% of tests catch 80% of bugs",
      "confidence_threshold": 50,
      "priority": "medium"
    },
    "parallel_opportunity": {
      "patterns": [
        "(?:and then|after that|next|followed by).+(?:and then|after|next)",
        "(?:first|then|finally|lastly)",
        "(?:step \\d+|\\d+\\.|1\\)|2\\))",
        "(?:sequential|one after another|in order)"
      ],
      "nudge_template": "‚ö° PARALLELIZATION OPPORTUNITY: Can these run concurrently?\n   ‚Ä¢ Native tool batching: Single message, multiple tool calls\n   ‚Ä¢ Independent operations CAN run in parallel\n   ‚Ä¢ Example: Read 3 files ‚Üí 1 message with 3 Read calls\n   ‚Ä¢ 3x faster, same result\n   ‚Ä¢ Sequential execution is token waste unless dependent",
      "confidence_threshold": 0,
      "priority": "medium"
    }
  },
  "context_aware_nudges": {
    "low_confidence_coding": {
      "condition": "confidence < 30 AND ('Write' in recent_tools OR 'Edit' in recent_tools)",
      "nudge_template": "üö´ IGNORANCE TIER VIOLATION: Confidence {confidence}% (IGNORANCE TIER).\n   ‚Ä¢ Allowed: Read, Research, Probe, Questions\n   ‚Ä¢ Blocked: Coding, Edits, Production changes\n   ‚Ä¢ Must reach 31%+ before coding\n   ‚Ä¢ Gather evidence first (read files, research, probe APIs)",
      "priority": "critical"
    },
    "tool_loop": {
      "condition": "tool_count >= 4 in last_5_turns",
      "nudge_template": "üîÅ LOOP DETECTED: {tool_name} used {count}x in 5 turns.\n   ‚Ä¢ This is a token waste pattern\n   ‚Ä¢ Write a scratch script instead\n   ‚Ä¢ Use parallel.py for bulk operations\n   ‚Ä¢ Scratch-First Protocol will escalate to hard block",
      "priority": "high"
    },
    "unverified_claim": {
      "condition": "'fixed' in last_message AND 'verify' not in last_10_tools",
      "nudge_template": "‚ö†Ô∏è UNVERIFIED CLAIM: 'Fixed' without verification.\n   ‚Ä¢ Run: /verify command_success '{test_command}'\n   ‚Ä¢ Reality Check Protocol: Claims need proof\n   ‚Ä¢ Exit code 0 = truth, your words = hypothesis\n   ‚Ä¢ Anti-gaslighting: LLMs hallucinate success",
      "priority": "critical"
    },
    "external_budget": {
      "condition": "('swarm' in command OR 'oracle' in command) AND turn_count < 5",
      "nudge_template": "üí∞ EXTERNAL BUDGET: {tool} burns API credits.\n   ‚Ä¢ Use for complex tasks only (not exploration)\n   ‚Ä¢ Verify necessity before running\n   ‚Ä¢ Alternative: Can parallel.py + stdlib solve this?\n   ‚Ä¢ Rule: Max 1 swarm/oracle call per turn without SUDO",
      "priority": "high"
    },
    "missing_upkeep": {
      "condition": "'commit' in command AND 'upkeep' not in last_20_tools",
      "nudge_template": "üßπ MISSING UPKEEP: git commit requires /upkeep first.\n   ‚Ä¢ Updates: tool index, requirements.txt, scratch cleanup\n   ‚Ä¢ Prevents: drift, stale deps, context pollution\n   ‚Ä¢ Command: python3 scripts/ops/upkeep.py\n   ‚Ä¢ Hard Block: Will trigger if you attempt commit",
      "priority": "critical"
    },
    "no_read_before_edit": {
      "condition": "'Edit' in current_tool AND file not in read_files_this_session",
      "nudge_template": "üìñ READ-FIRST VIOLATION: Attempting Edit without Read.\n   ‚Ä¢ You must Read file before editing\n   ‚Ä¢ Prevents: overwriting unknown content, context errors\n   ‚Ä¢ Hard Block: Edit will fail without prior Read\n   ‚Ä¢ Pattern: Read ‚Üí Understand ‚Üí Edit",
      "priority": "critical"
    }
  },
  "metacognitive_questions": [
    "ü§î What is the user REALLY trying to achieve? (Goal beyond stated task)",
    "üéØ Is there a simpler way to accomplish this? (Occam's Razor)",
    "üî¨ Do I actually understand this problem? (Confidence check)",
    "üß™ How will I verify this works? (Test plan)",
    "‚öñÔ∏è What are the hidden assumptions here? (Blind spots)",
    "üí° What tool/protocol fits this task best? (Tool selection)",
    "üö´ What could go wrong? (Risk analysis)",
    "üóëÔ∏è Can I delete code instead of adding? (Inversion)",
    "üìö Is my knowledge current for this? (Staleness check)",
    "üîÅ Am I repeating myself? (Iteration smell)",
    "üèóÔ∏è Is this the right level of abstraction? (Architecture)",
    "üîê Are there security implications? (Threat model)",
    "üìä What are the performance implications? (Scalability)",
    "üß© How does this integrate with existing code? (Integration)",
    "üìù What edge cases am I missing? (Completeness)"
  ],
  "meta": {
    "version": "1.0.0",
    "description": "Meta-cognition patterns for proactive tool/protocol suggestions and self-reflective prompts",
    "question_rotation_probability": 0.15,
    "max_nudges_per_turn": 3,
    "cache_ttl_seconds": 300
  }
}
